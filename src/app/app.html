<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>คำนวณต้นทุนหมูเป็น</title>
    <link rel="stylesheet" href="app.css">
</head>

<body>
    <div class="container">
        <div class="title-row">
            <h2>โปรแกรมคำนวณต้นทุนหมู</h2>
            <img src="assets/Picture1.png" alt="icon" class="title-img">
        </div>
    </div>
    <div class="main-container">
        <div class="main-content">
            <form #cvForm="ngForm" class="cv-form">
                <label for="cvCode">รหัสพนักงานขาย</label>
                <input
                    [(ngModel)]="cvCode"
                    name="cvCode"
                    id="cvCode"
                    required
                    class="cv-input"
                />

                <label for="salesId">รหัสลูกค้า</label>
                <input
                    [(ngModel)]="salesId"
                    name="salesId"
                    id="salesId"
                    required
                    class="cv-input"
                />
            </form>

            <div class="section-title">ข้อมูลหมู</div>
            <table class="pig-data-table">
                <tr>
                    <th class="col-head">รายการ</th>
                    <th class="col-customer">หมูเป็น</th>
                    <th class="col-cp">หมูซีกรวมหัวเครื่องใน CP</th>
                </tr>
                <tr>
                    <td class="col-head">น้ำหนักหมูเป็น (กก.)</td>
                    <td class="col-customer"><input class="fill-up" type="number" id="weight1" value="115"></td>
                    <td class="col-cp"><input class="disabled" type="number" id="weight2" value="0" readonly></td>
                </tr>
                <tr>
                    <td class="col-head">น้ำหนักหมูซีกรวมหัวเครื่องใน CP (กก.)</td>
                    <td class="col-customer"><input class="disabled" type="number" id="weightcp1" value="0" readonly></td>
                    <td class="col-cp"><input class="fill-up" type="number" id="weightcp2" value="105.80"></td>
                </tr>
                <tr>
                    <td class="col-head">ราคาหมูเป็น (บาท)</td>
                    <td class="col-customer"><input class="fill-up" type="number " id="price1" value="77"></td>
                    <td class="col-cp"><input class="disabled" type="number" id="price2" value="0" readonly></td>
                </tr>
                <tr>
                    <td class="col-head">ราคาหมูซีกรวมหัวเครื่องใน CP (บาท)</td>
                    <td class="col-customer"><input class="disabled" type="number" id="half1" value="0" readonly></td>
                    <td class="col-cp"><input class="fill-up" type="number" id="half2" value="85"></td>
                </tr>
            </table>
        </div>


        <div>
            <div class="section-title">น้ำหนักที่ได้ (กก.)</div>
            <div class="percent-dropdown" style="margin-bottom: 16px;">
                <label for="lossPercentSlider"><strong>น้ำหนักสูญเสีย:</strong></label>
                <input
                    type="range"
                    id="lossPercentSlider"
                    min="8"
                    max="15"
                    step="1"
                    value="8"
                    oninput="document.getElementById('lossPercentBox').value = this.value; calculate();"
                >
                <input
                    type="number"
                    id="lossPercentBox"
                    min="8"
                    max="15"
                    step="1"
                    value="8"
                    onclick="this.value='';"
                    oninput="
                        let v = Math.max(0, Math.min(15, parseInt(this.value) || 0));
                        this.value = v;
                        document.getElementById('lossPercentSlider').value = v;
                        calculate();
                    "
                > %
            </div>
            <table class="pig-weight-table">
                <tr>
                    <th class="col-head">รายการ</th>
                    <th class="col-customer">หมูเป็น</th>
                    <th class="col-cp">หมูซีกรวมหัวเครื่องใน CP</th>
                </tr>
                <tr>
                    <td class="col-head">น้ำหนักคงเหลือหลังจากเข้าเชือด</td>
                    <td class="col-customer" id="remain1">0</td>
                    <td class="col-cp" id="remain2">0</td>
                </tr>
                <tr>
                    <td class="col-head">น้ำหนักสูญหาย</td>
                    <td class="col-customer" id="loss1">0</td>
                    <td class="col-cp" id="loss2">0</td>
                </tr>
                <tr>
                    <th class="col-head">มูลค่าน้ำหนักที่สูญหาย (บาท)</th>
                    <th class="col-customer" id="lossCost1">0</th>
                    <th class="col-cp" id="lossCost2">0</th>
                </tr>
            </table>
        </div>

        <div>
            <div class="note">
                <strong>หมายเหตุ:</strong>
                <span class="black-bold"> หมูเป็น </span>จะสูญเสียน้ำหนักประมาณ
                <span class="red-underline"><strong id="lossPercentText">8%</strong></span> ระหว่างขั้นตอนการเชือด จาก
                <span class="red-underline">เลือด ขน กีบ และของเสียต่างๆ</span> ทำให้น้ำหนักสุทธิเหลือประมาณ
                <span class="black-bold"><strong id="remainPercentText">92%</strong></span> ของน้ำหนักหมูเป็น
            </div>
        </div>

        <div>
            <div class="section-title">รายการต้นทุนแฝง (ต่อตัว)</div>
            <table class="hidden-cost-table">
                <tr>
                    <th class="col-head">รายการ</th>
                    <th class="head-des">คำอธิบาย</th>
                    <th class="col-customer">ต้นทุนแฝง (บาท) หมูเป็น</th>
                    <th class="col-cp">ต้นทุนแฝง (บาท) หมูซีกรวมหัวเครื่องใน CP</th>
                </tr>
                <tr>
                    <td class="col-head">ค่าน้ำแข็ง</td>
                    <td class="ice-des">ต้นทุนเพิ่มจากการใช้/ซื้อ/ใส่น้ำแข็งเพื่อถนอมเนื้อหมู</td>
                    <td class="col-customer"><input class="fill-up" type="number" id="ice1" value="0"></td>
                    <td class="col-cp"><input class="fill-up" type="number" id="ice2" value="0"></td>
                </tr>
                <tr>
                    <td class="col-head">ค่าจ้างเชือด</td>
                    <td class="em-des">ค่าจ้างแรงงานในการเชือดจัดการหมูเป็น</td>
                    <td class="col-customer"><input class="fill-up" type="number" id="slaughter1" value="0"></td>
                    <td class="col-cp"><input class="fill-up" type="number" id="slaughter2" value="0"></td>
                </tr>
                <tr>
                    <td class="col-head">ค่าตัดแต่ง</td>
                    <td class="cut-des">ค่าใช้จ่ายในการตัดแต่งหมูเพิ่มเติม</td>
                    <td class="col-customer"><input class="fill-up" type="number" id="trim1" value="0"></td>
                    <td class="col-cp"><input class="fill-up" type="number" id="trim2" value="0"></td>
                </tr>
                <tr>
                    <td class="col-head">ค่าขนส่ง</td>
                    <td class="trans-des">ค่าขนส่งจากโรงเชือดถึงร้านค้า</td>
                    <td class="col-customer"><input class="fill-up" type="number" id="transport1" value="0"></td>
                    <td class="col-cp"><input class="fill-up" type="number" id="transport2" value="0"></td>
                </tr>
                <tr>
                    <td class="col-head">ค่าจ้างคนงาน</td>
                    <td class="emp-des">ค่าจ้างแรงงานเพิ่มเติม เช่น พนักงานขับรถส่งหมู</td>
                    <td class="col-customer"><input class="fill-up" type="number" id="worker1" value="0"></td>
                    <td class="col-cp"><input class="fill-up" type="number" id="worker2" value="0"></td>
                </tr>
                <tr>
                    <td class="col-head">ค่าใช้จ่ายอื่นๆ</td>
                    <td class="other-des">ค่าใช้จ่ายอื่นๆ</td>
                    <td class="col-customer"><input class="fill-up" type="number" id="other1" value="0"></td>
                    <td class="col-cp"><input class="fill-up" type="number" id="other2" value="0"></td>
                </tr>
                <tr>
                    <th class="col-head" colspan="2">รวมมูลค่าต้นทุนแฝง (บาท)</th>
                    <th class="col-customer" id="totalHidden1">0</th>
                    <th class="col-cp" id="totalHidden2">0</th>
                </tr>
            </table>
        </div>

        <div>
            <div class="section-title">สรุปต้นทุนหมู (ต่อตัว)</div>
            <table class="pig-cost-table">
                <tr>
                    <th class="col-head">รายการ</th>
                    <th class="fcost-detail">รายละเอียด</th>
                    <th class="col-customer">ต้นทุนหมูเป็น (บาท)</th>
                    <th class="col-cp">ต้นทุนหมูซีกรวมหัวเครื่องใน CP (บาท)</th>
                </tr>
                <tr>
                    <td class="col-head">หมู</td>
                    <td class="fcost-price">ราคาหมู x น้ำหนักหมู</td>
                    <td class="col-customer" id="pigCost1">0</td>
                    <td class="col-cp" id="pigCost2">0</td>
                </tr>
                <tr>
                    <td class="col-head">ต้นทุนแฝง</td>
                    <td class="fcost-hidden">มูลค่าต้นทุนแฝงทั้งหมด</td>
                    <td class="col-customer" id="hiddenCost1">0</td>
                    <td class="col-cp" id="hiddenCost2">0</td>
                </tr>
                <tr>
                    <th class="col-head" colspan="2">รวมต้นทุนหมู (ต่อตัว)</th>
                    <th class="col-customer" id="totalCost1">0</th>
                    <th class="col-cp" id="totalCost2">0</th>
                </tr>
            </table>
        </div>
        <div>
            <div class="section-title">สรุปกำไรที่ได้</div>
            <div class="percent-dropdown" style="margin-bottom: 16px;">
                <label for="avg-price"><strong>ราคาขายเฉลี่ย (บาท):</strong></label>
                <input class="fill-price" type="number" id="fillprice" value="">
                <span id="fillprice-warning" style="color: #d32f2f; margin-left: 12px; font-size: 0.95em;">*กรุณากรอกราคาขาย</span>
            </div>

            <table class="pig-cost-table">
                <tr>
                    <th class="col-head">รายการ</th>
                    <th class="fcost-detail">รายละเอียด</th>
                    <th class="col-customer">หมูเป็น (บาท)</th>
                    <th class="col-cp">หมูซีกรวมหัวเครื่องใน CP (บาท)</th>
                </tr>
                <tr>
                    <td class="col-head">รายได้จากหมู (ต่อตัว)</td>
                    <td class="fcost-price">น้ำหนักหมูหลังเข้าเชือด (กก.) x ราคาขายเฉลี่ย</td>
                    <td class="col-customer" id="pigPrice1">0</td>
                    <td class="col-cp" id="pigPrice2">0</td>
                </tr>
                <tr>
                    <td class="col-head">ต้นทุนหมูรวม</td>
                    <td class="fcost-hidden">ต้นทุนหมู (ต่อตัว) + ต้นทุนแฝง</td>
                    <td class="col-customer" id="totalCost3">0</td>
                    <td class="col-cp" id="totalCost4">0</td>
                </tr>
                <tr>
                    <th class="col-head" colspan="2">กำไรที่จะได้ (ต่อตัว)</th>
                    <th class="col-customer" id="pigProfit1">0</th>
                    <th class="col-cp" id="pigProfit2">0</th>
                </tr>
                 <tr>
                    <td class="col-head" colspan="2">กำไรที่จะได้ (ต่อกิโลกรัม)</td>
                    <td class="col-customer" id="pigProfitPerKg1">0</td>
                    <td class="col-cp" id="pigProfitPerKg2">0</td>
                </tr>
            </table>
        </div>
        <div>
            <div class="submit-area">
                <div class="submit-row">
                <button
                    type="button"
                    (click)="submit(true)"
                    [disabled]="loading"
                    >
                    {{ loading ? 'Saving...' : 'คำนวณ & บันทึกการใช้งาน' }}
                </button>
                </div>

            <div class="submit-message">
            <span *ngIf="!loading && message" class="msg-success">
                {{ message }}
            </span>

            <span
                *ngIf="!loading && !message && (cvCode === '' || salesId === '')"
                class="msg-warning"
                >
                *กรุณากรอก CV Code และ Sales ID หากต้องการบันทึก
            </span>
            </div>
        </div>

        </div>
    </div>

    <script src="app.ts"></script>
</body>

</html>